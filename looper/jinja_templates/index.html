<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS 
        /*!
         * Bootswatch v4.1.1
         * Homepage: https://bootswatch.com
         * Copyright 2012-2018 Thomas Park
         * Licensed under MIT
         * Based on Bootstrap
        *//*!
         * Bootstrap v4.1.1 (https://getbootstrap.com/)
         * Copyright 2011-2018 The Bootstrap Authors
         * Copyright 2011-2018 Twitter, Inc.
         * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
         -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <style>th{background-color:white;}</style>
        <title>Looper: {{ project_name }} summary</title>
    </head>
    {{ navbar }} 
    <body>
    	<div class="container">
  			<div class="row" style="margin-top: 20px; margin-bottom: 20px;">
  				<h2 class="col-10">Looper stats summary</h2>
  				<button type='button' href='{{ stats_file_path }}' class='btn btn-outline-primary'>Stats Summary File</button>
        </div>
        <div>
          <table class="display compact" id="data-table">
            <thead>
              <tr>
							{% for column in columns %}
								<th>{{ column }}</th>
							{% endfor %}
						  </tr>
            </thead>
					 <tbody>
					   {% for table_cell_data in table_row_data %}
							<tr>
								{% for values in table_cell_data %}
									{% if values is not string %}
										<td style="cursor:pointer" onclick="location.href='{{ values[0] }}'">
											<a class="LN1 LN2 LN3 LN4 LN5" href="{{ values[0] }}">{{ values[1] }}</a>
										</td>
									{% else %}
										<td class="text">
											{{ values }}
										</td>
									{% endif %}
								{% endfor %}
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="row">
				<div id="chartableColumns" class="col-3" style="margin: 20px;">
					<h4 style="margin: 20px;">Plottable Columns</h4>
					<ul id="plot-cols">
					</ul>
				</div>
				<div class="col">
					<div id="charts">

					</div>
				</div>
			</div>
    		{{ project_objects }}
            <!-- jQuery first, then Popper.js, then Bootstrap JS -->
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    
            <!-- D3.js -->
            <script src="https://d3js.org/d3.v5.min.js"></script>
            <!-- Plotly -->
            <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
            <!-- DataTables JQuery extension -->
            <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
            <script type="text/javascript">
              $.fn.dataTable.render.ellipsis = function ( cutoff, wordbreak, escapeHtml ) {
                  var esc = function ( t ) {
                      return t
                          .replace( /&/g, '&amp;' )
                          .replace( /</g, '&lt;' )
                          .replace( />/g, '&gt;' )
                          .replace( /"/g, '&quot;' );
                  };
                  function numberWithCommas(x) {
                      var parts = x.toString().split(".");
                      parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",");
                      return parts.join(".");
                  }
                  return function ( d, type, row ) {
                      // Order, search and type get the original data
                      if ( type !== 'display' ) {
                          return d;
                      }
                      if ( typeof d !== 'number' && typeof d !== 'string' ) {
                          return d;
                      }
                      d = d.toString(); // cast numbers
                      if(!isNaN(d)){
                          return numberWithCommas(d);
                      }
                      if ( d.length < cutoff ) {
                          return d;
                      }
                      var shortened = d.substr(0, cutoff-1);
                      // Find the last white space character in the string
                      if ( wordbreak ) {
                          shortened = shortened.replace(/\\s([^\\s]*)$/, '');
                      }
                      // Protect against uncontrolled HTML input
                      if ( escapeHtml ) {
                          shortened = esc( shortened );
                      }
                      return shortened;
                  };
              };
    
              $(document).ready(function() {
                $('#data-table').DataTable({
                  scrollX: true,
                  fixedColumns: {
                    leftColumns: 1
                  },
                  columnDefs: [
                    {
                      targets: 0,
                      render: $.fn.dataTable.render.ellipsis(1000, true, false)
                    },
                    {
                      targets: '_all',
                      render: $.fn.dataTable.render.ellipsis(17, true, true)
                    }
                  ],
                });
              } );
    
              var table = document.getElementById("data-table");
    
              function graphCol(colname){
                var table = document.getElementById("data-table");
                /* Creates a graph using Plotly.js */
                categories = getX();
                Ydata = getY(colname);
    
                var data = [{
                  x: categories,
                  y: Ydata,
                  type: 'bar',
                }];
    
                var layout = {
                  title: colname
                };
                chart = document.getElementById('charts');
                Plotly.newPlot(chart, data, layout);
              }
              function getX(){
                /* Get the sample names (the x values in the bar chart) */
                var rows = [];
                for(var i = 1, row; row = table.rows[i]; i++){
                  rows.push(row.cells[0].textContent);
                }
                return rows;
              }
              function getY(colname){
                /* Gets the data in the specified column name (the y values in the bar chart) */
                var data = [];
                var colnum;
                // find which column number is the one matching the column name
                for(var i = 0; i < table.rows[0].cells.length; i++){
                  if(table.rows[0].cells[i].textContent == colname){
                    colnum = i;
                    break;
                  }
                }
                // add the data from the column to an array
                for(var i = 1, row; row = table.rows[i]; i++){
                  data.push(row.cells[colnum].textContent);
                }
                return data;
              }
    
              function columnClicked(colname){
                /* The function that is called when a column's header is clicked */
                graphCol(colname);
              }

            </script>
      </div>
    </body>
</html>